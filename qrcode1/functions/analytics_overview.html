<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Analytics Dashboard | Event Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

  <div class="max-w-6xl mx-auto p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-amber-700">üìä Event Analytics Dashboard</h1>
      <a href="manage_event.html" class="bg-amber-700 text-white px-4 py-2 rounded hover:bg-amber-800">Manage events
      </a>
    </div>

    <!-- Overview Cards -->
    <div id="overview" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-white p-4 rounded shadow text-center">
        <h3 class="text-gray-500 text-sm mb-1">Countries</h3>
        <p id="totalCountries" class="text-2xl font-semibold">0</p>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <h3 class="text-gray-500 text-sm mb-1">Users</h3>
        <p id="totalUsers" class="text-2xl font-semibold">0</p>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <h3 class="text-gray-500 text-sm mb-1">Events</h3>
        <p id="totalEvents" class="text-2xl font-semibold">0</p>
      </div>
      <div class="bg-white p-4 rounded shadow text-center">
        <h3 class="text-gray-500 text-sm mb-1">Invited</h3>
        <p id="totalInvited" class="text-2xl font-semibold">0</p>
      </div>
    </div>

    <!-- Charts -->
    <div class="grid md:grid-cols-2 gap-6">
      <!-- Pie Chart -->
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-lg font-semibold mb-3 text-center">Invited vs Not Invited</h2>
        <canvas id="invitedPieChart"></canvas>
      </div>

      <!-- Bar Chart -->
      <div class="bg-white p-6 rounded shadow">
        <h2 class="text-lg font-semibold mb-3 text-center">Users & Events by Country</h2>
        <canvas id="countryBarChart"></canvas>
      </div>
    </div>
  </div>

<script>
const BASE_URL = "http://localhost:5001/fuze-be491/us-central1/v1";

document.addEventListener("DOMContentLoaded", () => {
  loadOverview();
  loadCharts();
});

// ---------- OVERVIEW ----------
async function loadOverview() {
  try {
    const res = await fetch(`${BASE_URL}/analytics/overview`);
    const data = await res.json();

    document.getElementById("totalCountries").textContent = data.totalCountries;
    document.getElementById("totalUsers").textContent = data.totalUsers;
    document.getElementById("totalEvents").textContent = data.totalEvents;
    document.getElementById("totalInvited").textContent = data.totalInvited;
  } catch (err) {
    console.error("‚ùå Failed to load overview:", err);
  }
}

// ---------- CHARTS ----------
async function loadCharts() {
  try {
    const res = await fetch(`${BASE_URL}/analytics/events`);
    const countries = await res.json();

    // --- Pie Chart (Invited vs Not Invited) ---
    const totalInvited = countries.reduce((sum, c) => sum + c.invited, 0);
    const totalNotInvited = countries.reduce((sum, c) => sum + c.notInvited, 0);

    new Chart(document.getElementById("invitedPieChart"), {
      type: "pie",
      data: {
        labels: ["Invited", "Not Invited"],
        datasets: [{
          data: [totalInvited, totalNotInvited],
          backgroundColor: ["#f59e0b", "#d1d5db"],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "bottom" },
        }
      }
    });

    // --- Bar Chart (Users & Events per Country) ---
    const labels = countries.map(c => c.country);
    const users = countries.map(c => c.users);
    const events = countries.map(c => c.events);

    new Chart(document.getElementById("countryBarChart"), {
      type: "bar",
      data: {
        labels,
        datasets: [
          {
            label: "Users",
            data: users,
            backgroundColor: "#f59e0b",
          },
          {
            label: "Events",
            data: events,
            backgroundColor: "#60a5fa",
          },
        ],
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true },
        },
        plugins: {
          legend: { position: "bottom" },
        },
      },
    });
  } catch (err) {
    console.error("‚ùå Failed to load chart data:", err);
  }
}
</script>
</body>
</html>
